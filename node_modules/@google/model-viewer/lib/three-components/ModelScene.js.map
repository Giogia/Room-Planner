{"version":3,"file":"ModelScene.js","sourceRoot":"","sources":["../../src/three-components/ModelScene.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Camera, Color, DirectionalLight, HemisphereLight, Object3D, PerspectiveCamera, Scene, Vector3} from 'three';\n\nimport ModelViewerElementBase from '../model-viewer-base.js';\nimport {resolveDpr} from '../utilities.js';\n\nimport Model from './Model.js';\nimport Renderer from './Renderer.js';\nimport StaticShadow from './StaticShadow.js';\n\nexport interface ModelSceneConfig {\n  element: ModelViewerElementBase;\n  canvas: HTMLCanvasElement;\n  width: number;\n  height: number;\n  renderer: Renderer;\n}\n\nexport type IlluminationRole = 'primary'|'secondary'\n\nexport const IlluminationRole: {[index: string]: IlluminationRole} = {\n  Primary: 'primary',\n  Secondary: 'secondary'\n};\n\n// The model is sized to the room, and if too perfect of a fit,\n// the front of the model becomes clipped by the near plane. Rather than\n// change the near plane or camera's position (if we wanted to implement a\n// visible \"room\" in the future where framing needs to be precise), we shrink\n// the room by a little bit so it's always slightly bigger than the model.\n// TODO(#527): this description has been incorrect for awhile (this is not\n// how the near plane is set) so this should probably be removed for simplicity.\nexport const ROOM_PADDING_SCALE = 1.01;\n\nconst AMBIENT_LIGHT_LOW_INTENSITY = 0.0;\nconst DIRECTIONAL_LIGHT_LOW_INTENSITY = 2.0;\n\nconst AMBIENT_LIGHT_HIGH_INTENSITY = 3.0;\nconst DIRECTIONAL_LIGHT_HIGH_INTENSITY = 4.0;\n\nconst $paused = Symbol('paused');\nconst $modelAlignmentMask = Symbol('modelAlignmentMask');\n\n/**\n * A THREE.Scene object that takes a Model and CanvasHTMLElement and\n * constructs a framed scene based off of the canvas dimensions.\n * Provides lights and cameras to be used in a renderer.\n */\nexport default class ModelScene extends Scene {\n  private[$paused]: boolean = false;\n  private[$modelAlignmentMask] = new Vector3(1, 1, 1);\n  private target = new Vector3();\n  private aspect: number;\n\n  public canvas: HTMLCanvasElement;\n  public light: HemisphereLight;\n  public renderer: Renderer;\n  public shadowLight: DirectionalLight;\n  public shadow: StaticShadow;\n  public pivot: Object3D;\n  public width: number;\n  public height: number;\n  public framedHeight: number = 1;\n  public modelDepth: number = 1;\n  public isVisible: boolean = false;\n  public isDirty: boolean = false;\n  public element: ModelViewerElementBase;\n  public context: CanvasRenderingContext2D;\n  public exposure: number;\n  public model: Model;\n  public camera: PerspectiveCamera;\n  public activeCamera: Camera;\n\n\n  /**\n   * @param {ModelViewerElementBase} options.element\n   * @param {CanvasHTMLElement} options.canvas\n   * @param {number} options.width\n   * @param {number} options.height\n   * @param {Renderer} options.renderer\n   */\n  constructor({canvas, element, width, height, renderer}: ModelSceneConfig) {\n    super();\n\n    this.name = 'ModelScene';\n\n    this.element = element;\n    this.canvas = canvas;\n    this.context = canvas.getContext('2d')!;\n    this.renderer = renderer;\n    this.exposure = 1;\n\n    this.model = new Model();\n    this.shadow = new StaticShadow();\n    this.light =\n        new HemisphereLight(0xBBBBBB, 0x444444, AMBIENT_LIGHT_HIGH_INTENSITY);\n    this.light.name = 'HemisphereLight';\n    this.light.position.set(2, 4, 2);\n\n    // This light is only for generating (fake) shadows\n    // and does not needed to be added to the scene.\n    // @see StaticShadow.js\n    this.shadowLight =\n        new DirectionalLight(0xffffff, DIRECTIONAL_LIGHT_HIGH_INTENSITY);\n    this.shadowLight.position.set(0, 10, 0);\n    this.shadowLight.name = 'ShadowLight';\n\n    this.width = width;\n    this.height = height;\n    this.aspect = width / height;\n    // These default camera values are never used, as they are reset once the\n    // model is loaded and framing is computed.\n    this.camera = new PerspectiveCamera(45, this.aspect, 0.1, 100);\n    this.camera.name = 'MainCamera';\n\n    this.activeCamera = this.camera;\n    this.pivot = new Object3D();\n    this.pivot.name = 'Pivot';\n\n    this.add(this.pivot);\n    this.add(this.light);\n    this.add(this.shadowLight);\n    this.pivot.add(this.model);\n\n    this.setSize(width, height);\n    this.background = new Color(0xffffff);\n\n    this.model.addEventListener(\n        'model-load', (event: any) => this.onModelLoad(event));\n  }\n\n  get paused() {\n    return this[$paused];\n  }\n\n  pause() {\n    this[$paused] = true;\n  }\n\n  resume() {\n    this[$paused] = false;\n  }\n\n  /**\n   * Sets the model via URL.\n   *\n   * @param {String?} source\n   * @param {Function?} progressCallback\n   */\n  async setModelSource(\n      source: string|null, progressCallback?: (progress: number) => void) {\n    try {\n      await this.model.setSource(source, progressCallback);\n    } catch (e) {\n      throw new Error(\n          `Could not set model source to '${source}': ${e.message}`);\n    }\n  }\n\n  /**\n   * Configures the alignment of the model within the frame based on value\n   * \"masks\". By default, the model will be aligned so that the center of its\n   * bounding box volume is in the center of the frame on all axes. In order to\n   * center the model this way, the model is translated by the delta between\n   * the world center of the bounding volume and world center of the frame.\n   *\n   * The alignment mask allows this translation to be scaled or eliminated\n   * completely for each of the three axes. So, setModelAlignment(1, 1, 1) will\n   * center the model in the frame. setModelAlignment(0, 0, 0) will align the\n   * model so that its root node origin is at [0, 0, 0] in the scene.\n   *\n   * @param {number} x\n   * @param {number} y\n   * @param {number} z\n   */\n  setModelAlignmentMask(...alignmentMaskValues: [number, number, number]) {\n    this[$modelAlignmentMask].set(...alignmentMaskValues);\n    this.alignModel();\n    this.isDirty = true;\n  }\n\n  /**\n   * Receives the size of the 2D canvas element to make according\n   * adjustments in the scene.\n   *\n   * @param {number} width\n   * @param {number} height\n   */\n  setSize(width: number, height: number) {\n    if (width !== this.width || height !== this.height) {\n      this.width = Math.max(width, 1);\n      this.height = Math.max(height, 1);\n      // In practice, invocations of setSize are throttled at the element level,\n      // so no need to throttle here:\n      this.updateFraming();\n    }\n  }\n\n  /**\n   * To frame the scene, a box is fit around the model such that the X and Z\n   * dimensions (modelDepth) are the same (for Y-rotation) and the X/Y ratio is\n   * the aspect ratio of the canvas (framedHeight is the Y dimension). For\n   * non-centered models, the box is fit symmetrically about the XZ origin to\n   * keep them in frame as they are rotated. At the ideal distance, the camera's\n   * fov exactly covers the front face of this box when looking down the Z-axis.\n   */\n  updateFraming() {\n    const dpr = resolveDpr();\n    this.canvas.width = this.width * dpr;\n    this.canvas.height = this.height * dpr;\n    this.canvas.style.width = `${this.width}px`;\n    this.canvas.style.height = `${this.height}px`;\n    this.aspect = this.width / this.height;\n\n    const {boundingBox, position, size} = this.model;\n    if (size.x != 0 || size.y != 0 || size.z != 0) {\n      const boxHalfX = Math.max(\n          Math.abs(boundingBox.min.x + position.x),\n          Math.abs(boundingBox.max.x + position.x));\n      const boxHalfZ = Math.max(\n          Math.abs(boundingBox.min.z + position.z),\n          Math.abs(boundingBox.max.z + position.z));\n\n      const modelMinY = Math.min(0, boundingBox.min.y + position.y);\n      const modelMaxY = Math.max(0, boundingBox.max.y + position.y);\n      this.target.y = this[$modelAlignmentMask].y * (modelMaxY + modelMinY) / 2;\n      const boxHalfY =\n          Math.max(modelMaxY - this.target.y, this.target.y - modelMinY);\n\n      this.modelDepth = 2 * Math.max(boxHalfX, boxHalfZ);\n      this.framedHeight = ROOM_PADDING_SCALE *\n          Math.max(2 * boxHalfY, this.modelDepth / this.aspect);\n      this.modelDepth *= ROOM_PADDING_SCALE;\n    }\n  }\n\n  configureStageLighting(\n      intensityScale: number, illuminationRole: IlluminationRole) {\n    this.light.intensity = intensityScale *\n        (illuminationRole === IlluminationRole.Primary ?\n             AMBIENT_LIGHT_HIGH_INTENSITY :\n             AMBIENT_LIGHT_LOW_INTENSITY);\n    this.shadowLight.intensity = intensityScale *\n        (illuminationRole === IlluminationRole.Primary ?\n             DIRECTIONAL_LIGHT_HIGH_INTENSITY :\n             DIRECTIONAL_LIGHT_LOW_INTENSITY);\n    this.isDirty = true;\n  }\n\n  /**\n   * Returns the size of the corresponding canvas element.\n   * @return {Object}\n   */\n  getSize(): {width: number, height: number} {\n    return {width: this.width, height: this.height};\n  }\n\n  /**\n   * Moves the model to be centered at the XZ origin, with Y = 0 being the floor\n   * under the model, taking into account setModelAlignmentMask(), described\n   * above.\n   */\n  alignModel() {\n    if (!this.model.hasModel() || this.model.size.length() === 0) {\n      return;\n    }\n\n    this.resetModelPose();\n\n    let centeredOrigin = this.model.boundingBox.getCenter(new Vector3());\n    centeredOrigin.y -= this.model.size.y / 2;\n    this.model.position.copy(centeredOrigin)\n        .multiply(this[$modelAlignmentMask])\n        .multiplyScalar(-1);\n\n    this.updateFraming();\n    this.updateStaticShadow();\n  }\n\n  resetModelPose() {\n    this.model.position.set(0, 0, 0);\n    this.model.rotation.set(0, 0, 0);\n    this.model.scale.set(1, 1, 1);\n  }\n\n  /**\n   * Returns the current camera.\n   * @return {THREE.Camera}\n   */\n  getCamera(): Camera {\n    return this.activeCamera;\n  }\n\n  /**\n   * Sets the passed in camera to be used for rendering.\n   * @param {THREE.Camera}\n   */\n  setCamera(camera: Camera) {\n    this.activeCamera = camera;\n  }\n\n  /**\n   * Called when the model's contents have loaded, or changed.\n   */\n  onModelLoad(event: {url: string}) {\n    this.alignModel();\n    this.dispatchEvent({type: 'model-load', url: event.url});\n  }\n\n  /**\n   * Called to update the shadow rendering when the room or model changes.\n   */\n  updateStaticShadow() {\n    if (!this.model.hasModel() || this.model.size.length() === 0) {\n      this.pivot.remove(this.shadow);\n      return;\n    }\n\n    // Remove and cache the current pivot rotation so that the shadow's\n    // capture is unrotated so it can be freely rotated when applied\n    // as a texture.\n    const currentRotation = this.pivot.rotation.y;\n    this.pivot.rotation.y = 0;\n\n    const modelPosition = this.model.boundingBox.getCenter(new Vector3())\n                              .add(this.model.position);\n    this.shadow.scale.x = 2 * Math.abs(modelPosition.x) + this.model.size.x;\n    this.shadow.scale.z = 2 * Math.abs(modelPosition.z) + this.model.size.z;\n\n    this.shadow.render(this.renderer.renderer, this, this.shadowLight);\n\n    // Lazily add the shadow so we're only displaying it once it has\n    // a generated texture.\n    this.pivot.add(this.shadow);\n    this.pivot.rotation.y = currentRotation;\n\n    // TODO(#453) When we add a configurable camera target we should put the\n    // floor back at y=0 for a consistent coordinate system.\n    if (this[$modelAlignmentMask].y == 0) {\n      this.shadow.position.y = modelPosition.y - this.model.size.y / 2;\n    }\n  }\n}\n"]}