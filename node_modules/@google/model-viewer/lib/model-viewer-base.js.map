{"version":3,"file":"model-viewer-base.js","sourceRoot":"","sources":["../src/model-viewer-base.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2019 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {property} from 'lit-element';\nimport {UpdatingElement} from 'lit-element/lib/updating-element';\n\nimport {HAS_INTERSECTION_OBSERVER, HAS_RESIZE_OBSERVER} from './constants.js';\nimport {makeTemplate} from './template.js';\nimport ModelScene from './three-components/ModelScene.js';\nimport Renderer from './three-components/Renderer.js';\nimport {debounce, deserializeUrl, resolveDpr} from './utilities.js';\nimport {ProgressTracker} from './utilities/progress-tracker.js';\n\nlet renderer = new Renderer();\n\nconst FALLBACK_SIZE_UPDATE_THRESHOLD_MS = 50;\nconst UNSIZED_MEDIA_WIDTH = 300;\nconst UNSIZED_MEDIA_HEIGHT = 150;\n\nconst $updateSize = Symbol('updateSize');\nconst $loaded = Symbol('loaded');\nconst $template = Symbol('template');\nconst $fallbackResizeHandler = Symbol('fallbackResizeHandler');\nconst $defaultAriaLabel = Symbol('defaultAriaLabel');\nconst $resizeObserver = Symbol('resizeObserver');\nconst $intersectionObserver = Symbol('intersectionObserver');\nconst $lastDpr = Symbol('lastDpr');\n\nexport const $ariaLabel = Symbol('ariaLabel');\nexport const $updateSource = Symbol('updateSource');\nexport const $markLoaded = Symbol('markLoaded');\nexport const $container = Symbol('container');\nexport const $canvas = Symbol('canvas');\nexport const $scene = Symbol('scene');\nexport const $needsRender = Symbol('needsRender');\nexport const $tick = Symbol('tick');\nexport const $onModelLoad = Symbol('onModelLoad');\nexport const $onResize = Symbol('onResize');\nexport const $onUserModelOrbit = Symbol('onUserModelOrbit');\nexport const $renderer = Symbol('renderer');\nexport const $resetRenderer = Symbol('resetRenderer');\nexport const $progressTracker = Symbol('progressTracker');\n\n/**\n * Definition for a basic <model-viewer> element.\n */\nexport default class ModelViewerElementBase extends UpdatingElement {\n  protected static[$template]: HTMLTemplateElement|void;\n\n  static get is() {\n    return 'model-viewer';\n  }\n\n  static get template() {\n    if (!this.hasOwnProperty($template)) {\n      this[$template] = makeTemplate(this.is);\n    }\n\n    return this[$template];\n  }\n\n  static[$resetRenderer]() {\n    renderer.dispose();\n    renderer = new Renderer();\n  }\n\n  @property({type: String}) alt: string|null = null;\n\n  @property({converter: {fromAttribute: deserializeUrl}})\n  src: string|null = null;\n\n  protected[$loaded]: boolean = false;\n  protected[$scene]: ModelScene;\n  protected[$container]: HTMLDivElement;\n  protected[$canvas]: HTMLCanvasElement;\n  protected[$defaultAriaLabel]: string;\n  protected[$lastDpr]: number = resolveDpr();\n\n  protected[$fallbackResizeHandler] = debounce(() => {\n    const boundingRect = this.getBoundingClientRect();\n    this[$updateSize](boundingRect);\n  }, FALLBACK_SIZE_UPDATE_THRESHOLD_MS);\n\n  protected[$resizeObserver]: ResizeObserver|null = null;\n  protected[$intersectionObserver]: IntersectionObserver|null = null;\n\n  protected[$progressTracker]: ProgressTracker = new ProgressTracker();\n\n  get loaded() {\n    return this[$loaded];\n  }\n\n  get[$renderer]() {\n    return renderer;\n  }\n\n  get modelIsVisible() {\n    return true;\n  }\n\n  /**\n   * Creates a new ModelViewerElement.\n   */\n  constructor() {\n    super();\n\n    // NOTE(cdata): It is *very important* to access this template first so that\n    // the ShadyCSS template preparation steps happen before element styling in\n    // IE11:\n    const template = (this.constructor as any).template as HTMLTemplateElement;\n\n    if ((window as any).ShadyCSS) {\n      (window as any).ShadyCSS.styleElement(this, {});\n    }\n\n    // NOTE(cdata): The canonical ShadyCSS examples suggest that the Shadow Root\n    // should be created after the invocation of ShadyCSS.styleElement\n    this.attachShadow({mode: 'open', delegatesFocus: true});\n\n    const shadowRoot = this.shadowRoot!;\n\n    shadowRoot.appendChild(template.content.cloneNode(true));\n\n    this[$container] = shadowRoot.querySelector('.container') as HTMLDivElement;\n    this[$canvas] = shadowRoot.querySelector('canvas') as HTMLCanvasElement;\n    this[$defaultAriaLabel] = this[$canvas].getAttribute('aria-label')!;\n\n    // Because of potential race conditions related to invoking the constructor\n    // we only use the bounding rect to set the initial size if the element is\n    // already connected to the document:\n    let width, height;\n    if (this.isConnected) {\n      const rect = this.getBoundingClientRect();\n      width = rect.width;\n      height = rect.height;\n    } else {\n      width = UNSIZED_MEDIA_WIDTH;\n      height = UNSIZED_MEDIA_HEIGHT;\n    }\n\n    // Create the underlying ModelScene.\n    this[$scene] = new ModelScene(\n        {canvas: this[$canvas], element: this, width, height, renderer});\n\n    this[$scene].addEventListener('model-load', (event) => {\n      this[$markLoaded]();\n      this[$onModelLoad](event);\n\n      this.dispatchEvent(new CustomEvent('load', {detail: {url: event.url}}));\n    });\n\n    // Update initial size on microtask timing so that subclasses have a\n    // chance to initialize\n    Promise.resolve().then(() => {\n      this[$updateSize](this.getBoundingClientRect(), true);\n    });\n\n    if (HAS_RESIZE_OBSERVER) {\n      // Set up a resize observer so we can scale our canvas\n      // if our <model-viewer> changes\n      this[$resizeObserver] = new ResizeObserver((entries) => {\n        // Don't resize anything if in AR mode; otherwise the canvas\n        // scaling to fullscreen on entering AR will clobber the flat/2d\n        // dimensions of the element.\n        if (renderer.isPresenting) {\n          return;\n        }\n\n        for (let entry of entries) {\n          if (entry.target === this) {\n            this[$updateSize](entry.contentRect);\n          }\n        }\n      });\n    }\n\n    if (HAS_INTERSECTION_OBSERVER) {\n      this[$intersectionObserver] = new IntersectionObserver(entries => {\n        for (let entry of entries) {\n          if (entry.target === this) {\n            this[$scene].isVisible = entry.isIntersecting;\n          }\n        }\n      }, {\n        root: null,\n        rootMargin: '10px',\n        threshold: 0,\n      });\n    } else {\n      // If there is no intersection obsever, then all models should be visible\n      // at all times:\n      this[$scene].isVisible = true;\n    }\n  }\n\n  connectedCallback() {\n    super.connectedCallback && super.connectedCallback();\n    if (HAS_RESIZE_OBSERVER) {\n      this[$resizeObserver]!.observe(this);\n    } else {\n      self.addEventListener('resize', this[$fallbackResizeHandler]);\n    }\n\n    if (HAS_INTERSECTION_OBSERVER) {\n      this[$intersectionObserver]!.observe(this);\n    }\n\n    this[$renderer].registerScene(this[$scene]);\n    this[$scene].isDirty = true;\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback && super.disconnectedCallback();\n    if (HAS_RESIZE_OBSERVER) {\n      this[$resizeObserver]!.unobserve(this);\n    } else {\n      self.removeEventListener('resize', this[$fallbackResizeHandler]);\n    }\n\n    if (HAS_INTERSECTION_OBSERVER) {\n      this[$intersectionObserver]!.unobserve(this);\n    }\n\n    this[$renderer].unregisterScene(this[$scene]);\n  }\n\n  updated(changedProperties: Map<string, any>) {\n    super.updated(changedProperties);\n\n    // NOTE(cdata): If a property changes from values A -> B -> A in the space\n    // of a microtask, LitElement/UpdatingElement will notify of a change even\n    // though the value has effectively not changed, so we need to check to make\n    // sure that the value has actually changed before changing the loaded flag.\n    if (changedProperties.has('src') && this.src !== this[$scene].model.url) {\n      this[$loaded] = false;\n      (async () => {\n        const updateSourceProgress = this[$progressTracker].beginActivity();\n        await this[$updateSource](\n            (progress: number) => updateSourceProgress(progress * 0.9));\n        updateSourceProgress(1.0);\n      })();\n    }\n\n    if (changedProperties.has('alt')) {\n      const ariaLabel = this.alt == null ? this[$defaultAriaLabel] : this.alt;\n      this[$canvas].setAttribute('aria-label', ariaLabel);\n    }\n  }\n\n  toDataURL(type?: string, encoderOptions?: number): string {\n    return this[$canvas].toDataURL(type, encoderOptions);\n  }\n\n  get[$ariaLabel]() {\n    return (this.alt == null || this.alt === 'null') ? this[$defaultAriaLabel] :\n                                                       this.alt;\n  }\n\n  /**\n   * Called on initialization and when the resize observer fires.\n   */\n  [$updateSize](\n      {width, height}: {width: any, height: any}, forceApply = false) {\n    const {width: prevWidth, height: prevHeight} = this[$scene].getSize();\n    // Round off the pixel size\n    const intWidth = parseInt(width, 10);\n    const intHeight = parseInt(height, 10);\n\n    this[$container].style.width = `${width}px`;\n    this[$container].style.height = `${height}px`;\n\n    if (forceApply || (prevWidth !== intWidth || prevHeight !== intHeight)) {\n      this[$onResize]({width: intWidth, height: intHeight});\n    }\n  }\n\n  [$tick](_time: number, _delta: number) {\n    const dpr = resolveDpr();\n    // There is no standard way to detect when DPR changes on account of zoom.\n    // Here we keep a local copy of DPR updated, and when it changes we invoke\n    // the fallback resize handler. It might be better to invoke the resize\n    // handler directly in this case, but the fallback is debounced which will\n    // save us from doing too much work when DPR and window size changes at the\n    // same time.\n    if (dpr !== this[$lastDpr]) {\n      this[$lastDpr] = dpr;\n      this[$fallbackResizeHandler]();\n    }\n  }\n\n  [$markLoaded]() {\n    if (this[$loaded]) {\n      return;\n    }\n\n    this[$loaded] = true;\n    // Asynchronously invoke `update`:\n    this.requestUpdate();\n  }\n\n  [$needsRender]() {\n    this[$scene].isDirty = true;\n  }\n\n  [$onModelLoad](_event: any) {\n    this[$needsRender]();\n  }\n\n  [$onResize](e: {width: number, height: number}) {\n    this[$scene].setSize(e.width, e.height);\n    this[$needsRender]();\n  }\n\n  [$onUserModelOrbit]() {\n  }\n\n  /**\n   * Parses the element for an appropriate source URL and\n   * sets the views to use the new model based off of the `preload`\n   * attribute.\n   */\n  async[$updateSource](\n      progressCallback: (progress: number) => void = () => {}) {\n    const source = this.src;\n\n    try {\n      this[$canvas].classList.add('show');\n      await this[$scene].setModelSource(source, progressCallback);\n    } catch (error) {\n      this[$canvas].classList.remove('show');\n      this.dispatchEvent(new CustomEvent('error', {detail: error}));\n    }\n  }\n}\n"]}