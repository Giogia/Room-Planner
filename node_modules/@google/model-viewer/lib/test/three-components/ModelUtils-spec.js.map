{"version":3,"file":"ModelUtils-spec.js","sourceRoot":"","sources":["../../../src/test/three-components/ModelUtils-spec.ts"],"names":[],"mappings":"AAiBA,OAAO,EAAC,UAAU,EAAC,MAAM,0CAA0C,CAAC;AACpE,OAAO,EAAC,cAAc,EAAC,MAAM,6CAA6C,CAAC;AAC3E,OAAO,EAAC,SAAS,EAAO,MAAM,sCAAsC,CAAC;AACrE,OAAO,EAAC,SAAS,EAAC,MAAM,eAAe,CAAC;AAExC,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;AAE3B,MAAM,kBAAkB,GAAG,SAAS,CAAC,eAAe,CAAC,CAAC;AAEtD,MAAM,gBAAgB,GAAG,CAAC,KAAY,EAAmB,EAAE;IACzD,MAAM,SAAS,GAAoB,EAAE,CAAC;IAEtC,KAAK,CAAC,QAAQ,CAAC,CAAC,IAAS,EAAE,EAAE;QAC3B,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE;YAChC,SAAS,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC;SAClC;aAAM,IAAI,IAAI,CAAC,QAAQ,IAAI,IAAI,EAAE;YAChC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;SAC/B;IACH,CAAC,CAAC,CAAC;IAEH,OAAO,SAAS,CAAC;AACnB,CAAC,CAAC;AAEF,KAAK,CAAC,YAAY,EAAE,GAAG,EAAE;IACvB,KAAK,CAAC,WAAW,EAAE,GAAG,EAAE;QACtB,IAAI,MAAW,CAAC;QAChB,IAAI,IAAU,CAAC;QAEf,KAAK,CAAC,KAAK,IAAI,EAAE;YACf,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;YAC1B,IAAI,GAAG,MAAM,cAAc,CAAC,kBAAkB,EAAE,MAAM,CAAC,CAAC;QAC1D,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,sCAAsC,EAAE,GAAG,EAAE;YAChD,MAAM,UAAU,GAAG,SAAS,CAAC,IAAI,CAAC,CAAC;YAEnC,MAAM,eAAe,GAAG,gBAAgB,CAAC,IAAI,CAAC,KAAM,CAAC,CAAC;YACtD,MAAM,eAAe,GAAG,gBAAgB,CAAC,UAAU,CAAC,KAAM,CAAC,CAAC;YAE5D,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;YACpD,MAAM,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,KAAK,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;YAEnE,eAAe,CAAC,OAAO,CAAC,CAAC,QAAQ,EAAE,KAAK,EAAE,EAAE;gBAC1C,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;YACzD,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["\n/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {Material, Scene} from 'three';\n\nimport {GLTFLoader} from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport {loadWithLoader} from '../../three-components/CachingGLTFLoader.js';\nimport {cloneGltf, Gltf} from '../../three-components/ModelUtils.js';\nimport {assetPath} from '../helpers.js';\n\nconst expect = chai.expect;\n\nconst ASTRONAUT_GLB_PATH = assetPath('Astronaut.glb');\n\nconst collectMaterials = (scene: Scene): Array<Material> => {\n  const materials: Array<Material> = [];\n\n  scene.traverse((node: any) => {\n    if (Array.isArray(node.material)) {\n      materials.push(...node.material);\n    } else if (node.material != null) {\n      materials.push(node.material);\n    }\n  });\n\n  return materials;\n};\n\nsuite('ModelUtils', () => {\n  suite('cloneGltf', () => {\n    let loader: any;\n    let gltf: Gltf;\n\n    setup(async () => {\n      loader = new GLTFLoader();\n      gltf = await loadWithLoader(ASTRONAUT_GLB_PATH, loader);\n    });\n\n    test('makes unique copies of all materials', () => {\n      const clonedGltf = cloneGltf(gltf);\n\n      const sourceMaterials = collectMaterials(gltf.scene!);\n      const clonedMaterials = collectMaterials(clonedGltf.scene!);\n\n      expect(sourceMaterials.length).to.be.greaterThan(0);\n      expect(sourceMaterials.length).to.be.equal(clonedMaterials.length);\n\n      sourceMaterials.forEach((material, index) => {\n        expect(clonedMaterials[index]).to.not.be.eql(material);\n      });\n    });\n  });\n});\n"]}