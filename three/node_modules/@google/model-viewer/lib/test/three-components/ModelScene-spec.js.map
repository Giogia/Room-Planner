{"version":3,"file":"ModelScene-spec.js","sourceRoot":"","sources":["../../../src/test/three-components/ModelScene-spec.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {Matrix4, Mesh, Object3D, SphereBufferGeometry, Vector3} from 'three';\n\nimport ModelViewerElementBase, {$canvas} from '../../model-viewer-base.js';\nimport ModelScene, {ROOM_PADDING_SCALE} from '../../three-components/ModelScene.js';\nimport Renderer from '../../three-components/Renderer.js';\nimport {assetPath} from '../helpers.js';\n\n\nconst expect = chai.expect;\n\nsuite('ModelScene', () => {\n  let element: ModelViewerElementBase;\n  let scene: ModelScene;\n  let dummyRadius: number;\n  let dummyMesh: Mesh;\n  let renderer: Renderer;\n  let ModelViewerElement = class extends ModelViewerElementBase {};\n\n  customElements.define('model-viewer-modelscene', ModelViewerElement);\n\n  suiteSetup(() => {\n    renderer = new Renderer();\n  });\n\n  suiteTeardown(() => {\n    renderer.dispose();\n  });\n\n  setup(() => {\n    // Set the radius of the sphere to 0.5 so that it's size is 1\n    // for testing scaling.\n    dummyRadius = 0.5;\n    dummyMesh = new Mesh(new SphereBufferGeometry(dummyRadius, 32, 32));\n    element = new ModelViewerElement();\n    scene = new ModelScene({\n      element: element,\n      canvas: element[$canvas],\n      width: 200,\n      height: 100,\n      renderer,\n    });\n  });\n\n  suite('setModelSource', () => {\n    test('fires a model-load event when loaded', async function() {\n      let fired = false;\n      scene.addEventListener('model-load', () => fired = true);\n      await scene.setModelSource(assetPath('Astronaut.glb'));\n      expect(fired).to.be.ok;\n    });\n  });\n\n  suite('setSize', () => {\n    test('updates visual and buffer size', () => {\n      scene.setSize(500, 200);\n      expect(scene.width).to.be.equal(500);\n      expect(scene.canvas.width).to.be.equal(500 * devicePixelRatio);\n      expect(scene.canvas.style.width).to.be.equal('500px');\n      expect(scene.height).to.be.equal(200);\n      expect(scene.canvas.height).to.be.equal(200 * devicePixelRatio);\n      expect(scene.canvas.style.height).to.be.equal('200px');\n    });\n\n    test('scales when X-bound', () => {\n      dummyMesh.geometry.applyMatrix(new Matrix4().makeScale(10, 3, 1));\n      scene.model.setObject(dummyMesh);\n\n      const width = 2000;\n      const height = 1000;\n      const aspect = width / height;\n      scene.setSize(width, height);\n\n      expect(scene.framedHeight).to.be.equal(ROOM_PADDING_SCALE * 10 / aspect);\n    });\n\n    test('scales when Z-bound', () => {\n      dummyMesh.geometry.applyMatrix(new Matrix4().makeScale(1, 3, 10));\n      scene.model.setObject(dummyMesh);\n\n      const width = 2000;\n      const height = 1000;\n      const aspect = width / height;\n      scene.setSize(width, height);\n\n      expect(scene.framedHeight).to.be.equal(ROOM_PADDING_SCALE * 10 / aspect);\n    });\n\n    test('scales when Y-bound', () => {\n      dummyMesh.geometry.applyMatrix(new Matrix4().makeScale(3, 10, 1));\n      scene.model.setObject(dummyMesh);\n\n      const width = 2000;\n      const height = 1000;\n      scene.setSize(width, height);\n\n      expect(scene.framedHeight).to.be.equal(ROOM_PADDING_SCALE * 10);\n    });\n\n    test('model is not scaled', () => {\n      dummyMesh.geometry.applyMatrix(new Matrix4().makeScale(1, 3, 10));\n      scene.model.setObject(dummyMesh);\n\n      scene.setSize(1000, 500);\n      expect(scene.model.scale).to.be.eql(new Vector3(1, 1, 1));\n    });\n\n    test('cannot set the canvas smaller than 1x1', () => {\n      scene.setSize(0, 0);\n      expect(scene.width).to.be.equal(1);\n      expect(scene.height).to.be.equal(1);\n    });\n  });\n\n  suite('alignModel', () => {\n    test('does not throw if model has no volume', () => {\n      scene.model.setObject(new Object3D());\n      scene.alignModel();\n    });\n\n    test('does not throw if model not loaded', () => {\n      scene.model.modelContainer.add(dummyMesh);\n      scene.model.updateBoundingBox();\n      scene.alignModel();\n    });\n\n    test('updates object position to center it on the floor', () => {\n      scene.setSize(1000, 500);\n      dummyMesh.geometry.applyMatrix(new Matrix4().makeTranslation(5, 10, 20));\n      scene.model.setObject(dummyMesh);\n\n      scene.alignModel();\n\n      expect(scene.model.position)\n          .to.be.eql(new Vector3(-5, dummyRadius - 10, -20));\n    });\n  });\n});\n"]}