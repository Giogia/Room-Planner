{"version":3,"file":"EnvironmentMapGenerator.js","sourceRoot":"","sources":["../../src/three-components/EnvironmentMapGenerator.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright 2018 Google Inc. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {BackSide, BoxBufferGeometry, CubeCamera, EventDispatcher, HalfFloatType, LinearMipMapLinearFilter, LinearToneMapping, Mesh, MeshBasicMaterial, MeshStandardMaterial, PointLight, RGBAFormat, Scene, ShaderMaterial, Texture, WebGLRenderer, WebGLRenderTargetCube} from 'three';\n\nconst rendererTextureCache = new Map<WebGLRenderer, Texture>();\n\nexport default class EnvironmentMapGenerator extends EventDispatcher {\n  protected scene: Scene = new Scene();\n  protected camera: CubeCamera;\n\n  protected blurScene: Scene;\n  protected blurCamera: CubeCamera;\n  protected blurMaterial: ShaderMaterial;\n\n  protected blurRenderTarget1: WebGLRenderTargetCube;\n  protected blurRenderTarget2: WebGLRenderTargetCube;\n\n  protected createAreaLightMaterial(intensity: number): MeshBasicMaterial {\n    const material = new MeshBasicMaterial();\n    material.color.setScalar(intensity);\n    return material;\n  }\n\n  constructor(protected renderer: WebGLRenderer) {\n    super();\n\n    // Scene\n\n    const {scene} = this;\n    scene.position.y = -3.5;\n\n    const geometry = new BoxBufferGeometry();\n    geometry.removeAttribute('uv');\n\n    const roomMaterial =\n        new MeshStandardMaterial({metalness: 0, side: BackSide});\n    const boxMaterial = new MeshStandardMaterial({metalness: 0});\n\n    const mainLight = new PointLight(0xffffff, 500.0, 28, 2);\n    mainLight.position.set(0.418, 16.199, 0.300);\n    scene.add(mainLight);\n\n    const room = new Mesh(geometry, roomMaterial);\n    room.position.set(-0.757, 13.219, 0.717);\n    room.scale.set(31.713, 28.305, 28.591);\n    scene.add(room);\n\n    const box1 = new Mesh(geometry, boxMaterial);\n    box1.position.set(-10.906, 2.009, 1.846);\n    box1.rotation.set(0, -0.195, 0);\n    box1.scale.set(2.328, 7.905, 4.651);\n    scene.add(box1);\n\n    const box2 = new Mesh(geometry, boxMaterial);\n    box2.position.set(-5.607, -0.754, -0.758);\n    box2.rotation.set(0, 0.994, 0);\n    box2.scale.set(1.970, 1.534, 3.955);\n    scene.add(box2);\n\n    const box3 = new Mesh(geometry, boxMaterial);\n    box3.position.set(6.167, 0.857, 7.803);\n    box3.rotation.set(0, 0.561, 0);\n    box3.scale.set(3.927, 6.285, 3.687);\n    scene.add(box3);\n\n    const box4 = new Mesh(geometry, boxMaterial);\n    box4.position.set(-2.017, 0.018, 6.124);\n    box4.rotation.set(0, 0.333, 0);\n    box4.scale.set(2.002, 4.566, 2.064);\n    scene.add(box4);\n\n    const box5 = new Mesh(geometry, boxMaterial);\n    box5.position.set(2.291, -0.756, -2.621);\n    box5.rotation.set(0, -0.286, 0);\n    box5.scale.set(1.546, 1.552, 1.496);\n    scene.add(box5);\n\n    const box6 = new Mesh(geometry, boxMaterial);\n    box6.position.set(-2.193, -0.369, -5.547);\n    box6.rotation.set(0, 0.516, 0);\n    box6.scale.set(3.875, 3.487, 2.986);\n    scene.add(box6);\n\n\n    // -z right\n    const light1 = new Mesh(geometry, this.createAreaLightMaterial(50));\n    light1.position.set(-16.116, 14.37, 8.208);\n    light1.scale.set(0.1, 2.428, 2.739);\n    scene.add(light1);\n\n    // -z left\n    const light2 = new Mesh(geometry, this.createAreaLightMaterial(50));\n    light2.position.set(-16.109, 18.021, -8.207);\n    light2.scale.set(0.1, 2.425, 2.751);\n    scene.add(light2);\n\n    // +z\n    const light3 = new Mesh(geometry, this.createAreaLightMaterial(17));\n    light3.position.set(14.904, 12.198, -1.832);\n    light3.scale.set(0.15, 4.265, 6.331);\n    scene.add(light3);\n\n    // +x\n    const light4 = new Mesh(geometry, this.createAreaLightMaterial(43));\n    light4.position.set(-0.462, 8.89, 14.520);\n    light4.scale.set(4.38, 5.441, 0.088);\n    scene.add(light4);\n\n    // -x\n    const light5 = new Mesh(geometry, this.createAreaLightMaterial(20));\n    light5.position.set(3.235, 11.486, -12.541);\n    light5.scale.set(2.5, 2.0, 0.1);\n    scene.add(light5);\n\n    this.camera = new CubeCamera(0.1, 100, 256);\n    this.camera.renderTarget.texture.type = HalfFloatType;\n    this.camera.renderTarget.texture.format = RGBAFormat;\n    this.camera.renderTarget.texture.minFilter = LinearMipMapLinearFilter;\n    this.camera.renderTarget.texture.generateMipmaps = true;\n\n    // Blur\n\n    this.blurScene = new Scene();\n\n    this.blurMaterial = new ShaderMaterial({\n      uniforms: {tCube: {value: null}},\n      vertexShader: `\n        varying vec3 vWorldDirection;\n        #include <common>\n        void main() {\n          vWorldDirection = transformDirection( position, modelMatrix );\n          #include <begin_vertex>\n          #include <project_vertex>\n          gl_Position.z = gl_Position.w;\n        }\n      `,\n      fragmentShader: `\n        uniform samplerCube tCube;\n        varying vec3 vWorldDirection;\n        void main() {\n          vec4 texColor = textureCube( tCube, vec3( - vWorldDirection.x, vWorldDirection.yz ), 2.0 );\n          gl_FragColor = mapTexelToLinear( texColor );\n        }\n      `,\n      side: BackSide,\n      depthTest: false,\n      depthWrite: false\n    });\n\n    this.blurScene.add(new Mesh(geometry, this.blurMaterial));\n\n    this.blurCamera = new CubeCamera(0.1, 100, 256);\n    this.blurCamera.renderTarget.texture.type = HalfFloatType;\n    this.blurCamera.renderTarget.texture.format = RGBAFormat;\n    this.blurCamera.renderTarget.texture.minFilter = LinearMipMapLinearFilter;\n    this.blurCamera.renderTarget.texture.generateMipmaps = true;\n\n    //\n\n    this.blurRenderTarget1 = this.camera.renderTarget;\n    this.blurRenderTarget2 = this.blurCamera.renderTarget;\n  }\n\n  /**\n   * Generate an environment map for a room.\n   */\n  generate(): Texture {\n    if (!rendererTextureCache.has(this.renderer)) {\n      (this.camera as any).clear(this.renderer);\n\n      var gammaOutput = this.renderer.gammaOutput;\n      var toneMapping = this.renderer.toneMapping;\n      var toneMappingExposure = this.renderer.toneMappingExposure;\n\n      this.renderer.toneMapping = LinearToneMapping;\n      this.renderer.toneMappingExposure = 1.0;\n      this.renderer.gammaOutput = false;\n\n      this.camera.update(this.renderer, this.scene);\n\n      // Blur\n\n      for (var i = 0; i < 16; i++) {\n        // Ping-Pong\n        if (i % 2 === 0) {\n          this.blurMaterial.uniforms.tCube.value =\n              this.blurRenderTarget1.texture;\n          this.blurCamera.renderTarget = this.blurRenderTarget2;\n        } else {\n          this.blurMaterial.uniforms.tCube.value =\n              this.blurRenderTarget2.texture;\n          this.blurCamera.renderTarget = this.blurRenderTarget1;\n        }\n        this.blurCamera.update(this.renderer, this.blurScene);\n      }\n\n      this.renderer.toneMapping = toneMapping;\n      this.renderer.toneMappingExposure = toneMappingExposure;\n      this.renderer.gammaOutput = gammaOutput;\n\n      rendererTextureCache.set(\n          this.renderer, this.blurCamera.renderTarget.texture);\n    }\n\n    return rendererTextureCache.get(this.renderer)!;\n  }\n\n  dispose() {\n    this.camera.renderTarget.dispose();\n    this.blurRenderTarget1.dispose();\n    this.blurRenderTarget2.dispose();\n  }\n}\n"]}